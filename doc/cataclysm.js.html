<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: cataclysm.js</title>
    
    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">
    
    <h1 class="page-title">Source: cataclysm.js</h1>
    
    


    
    <section>
        <article>
            <pre class="prettyprint source"><code>/**
 * @overview Extension for Environment class
 * @author Yevhen Lysyakov
 */

 /**
 * Set of cataclysm methods
 * @mixin
 */
Cataclysm = {

	cataclysm: function() {
		var randVal = Math.round(Math.random() * config.cataclysmChance);

		this.stop();

		switch (randVal) {
			case 1:
				this.lifeTimeCataclysm();
				break;
			case 2:
				this.colorCataclysm();
				break;
			default:
				break;
		}

		this.play();
	},

	/**
	 * Removes weak cells depending on lifeTime
	 */
	lifeTimeCataclysm: function() {
		console.log('lifeTimeCataclysm');
		
		var self = this;
		var res = [];
		var distanceToSource;
		var cataclysmRadius = Math.random() * config.cataclysmLifeTimeRadius;

		var source = this.getSourcePoint();

		var lifeTimeMax = _.max(this.population, function(cell){ return cell.lifeTime; });
		var lifeTimeMin = _.min(this.population, function(cell){ return cell.lifeTime; });
		var lifeTimePart = (lifeTimeMax.lifeTime + lifeTimeMin.lifeTime) / (2 * cataclysmRadius);

		this.population.forEach(function(cell, index) {
			distanceToSource = Math.sqrt((cell.pos[0] - source[0])*(cell.pos[0] - source[0]) + (cell.pos[1] - source[1])*(cell.pos[1] - source[1]));

			if (distanceToSource &lt; cataclysmRadius) {
				cell.timeLeft -= lifeTimePart * (cataclysmRadius - distanceToSource);
				if (cell.timeLeft &lt; 1) {
					self.places[cell.pos[0]][cell.pos[1]] = 0;
				} else {
					//_.extend(cell, cell.getMutatedColor());
					res.push(cell);		
				}
			} else {
				res.push(cell);
			}
		});

		this.population = res;
	},

	/**
	 * Changes cells color near source point
	 */
	colorCataclysm: function() {
		console.log('colorCataclysm');
		
		var res = [];
		var newCell;
		var distanceToSource;
		var cataclysmRadius = Math.random() * 10;
		var i, color;

		var source = this.getSourcePoint();

		var minLifeTimeCell = _.min(this.population, function(cell){ return cell.lifeTime; });
		var minLifeTimePart = minLifeTimeCell.lifeTime/cataclysmRadius;

		this.population.forEach(function(cell, index) {
			distanceToSource = Math.sqrt((cell.pos[0] - source[0])*(cell.pos[0] - source[0]) + (cell.pos[1] - source[1])*(cell.pos[1] - source[1]));

			if (distanceToSource &lt; cataclysmRadius) {
				i = Math.round(Math.random() * 2);
				color = Math.round((cell.color[i] + distanceToSource)%255);
				cell.color[i] = color;
			}
			res.push(cell);
		});

		this.population = res;
	},

	/**
	 * Creates source point
	 * @returns {Array} Returns point coordinates
	 */
	getSourcePoint: function() {
		// defines max positions
		var maxX = _.max(this.population, function(cell){ return cell.pos[0]; });
		var maxY = _.max(this.population, function(cell){ return cell.pos[1]; });

		// cataclysm sourse point coordinates
		return [Math.round( Math.random() * maxX.pos[0] ), Math.round( Math.random() * maxY.pos[1] )];
	}

};</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Classes</h3><ul><li><a href="Cell.html">Cell</a></li><li><a href="Environment.html">Environment</a></li></ul><h3>Mixins</h3><ul><li><a href="Cataclysm.html">Cataclysm</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.2</a> on Sat Sep 13 2014 18:39:32 GMT+0200 (GMT+02:00)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
