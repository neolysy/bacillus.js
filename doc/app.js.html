<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: app.js</title>
    
    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">
    
    <h1 class="page-title">Source: app.js</h1>
    
    


    
    <section>
        <article>
            <pre class="prettyprint source"><code>env = {
	cells: [],
	places: [],
	maxLeft: 1000,
	maxTop: 1000,
	maxPopulation: 5000,
	chance: 1000,
	canvas: null,
	iterator: null,

	init: function() {
		this.canvas = document.getElementById('field');
		this.canvas.width = env.maxLeft;
		this.canvas.height = env.maxTop;

		// creates first cell
		var parent = new Cell();
		// var parent2 = new Cell({pos: [50, 100], color: [15, 207, 110]});
		// var parent3 = new Cell({pos: [150, 100]});
		// var parent4 = new Cell({pos: [200, 150]});
		// var parent5 = new Cell({pos: [300, 200]});

		this.attachCanvasEvents();
	},

	render: function() {
		env.cataclysm();

		var canvas = document.getElementById('field');
		var ctx = canvas.getContext('2d');
		var rgb, 
			cellsArr = [];

		ctx.clearRect ( 0 , 0 , canvas.width, canvas.height );

		env.cells.forEach(function(cell, index) {
			rgb = cell.color;
			ctx.fillStyle = "rgb(" + rgb[0] + ',' + rgb[1] + ',' + rgb[2] + ")";
			ctx.fillRect(cell.pos[0]*cell.size, cell.pos[1]*cell.size, cell.size, cell.size);

			cell.timeLeft--;
			cell.fat += cell.fatPerIteration;
			
			if (cell.timeLeft !== 0) {
				cellsArr.push(cell);
			} else {
				env.places[cell.pos[0]][cell.pos[1]] = undefined;
			}

			if (cell.canReproduce()) {
				var child = cell.reproduce();
				if (child) cellsArr.push(child);
			} else if (cell.canMove) {
				cell.move();
			}
		});

		env.cells = cellsArr;
	},

	cataclysm: function() {
		var randVal = Math.round(Math.random()*200);
		if (randVal !== 27) return;

		console.log('cataclysm');

		clearInterval(this.iterator);

		var cond = this.getCataclysmConditions();
		var res = [];

		this.cells.forEach(_.bind(function(cell, index) {
			if (cell.lifeTime > cond.lifeTime && cell.timeLeft > cond.timeLeft) {
				_.extend(cell, cell.changeColor());
				res.push(cell);
			} else {
				this.places[cell.pos[0]][cell.pos[1]] = undefined;
			}
		}, this));

		this.cells = res;
		this.iterator = setInterval(this.render, 100);
	},

	getCataclysmConditions: function() {
		var lifeTimeMax = _.max(this.cells, function(cell){ return cell.lifeTime; }),
			lifeTimeMin = _.min(this.cells, function(cell){ return cell.lifeTime; }),
			lifeTime = (lifeTimeMax.lifeTime + lifeTimeMin.lifeTime)/2;

		return {
			lifeTime: lifeTime,
			timeLeft: lifeTime/2
		};
	},

	attachCanvasEvents: function() {
		this.canvas.addEventListener('click', _.bind(function() {
			this[this.iterator ? 'stop' : 'play']();
		}, this), false);

		return this.canvas;
	},

	/**
	 * Starts cells actions
	 * @returns {Object} Returns current environment instance
	 */
	play: function() {
		this.iterator = setInterval(this.render, 100);
		return this;
	},

	/**
	 * Stops all actions in environment
	 * @returns {Object} Returns current environment instance
	 */
	stop: function() {
		clearInterval(this.iterator);
		this.iterator = null;

		return this;
	}
};

(function() {
	env.init();
})();
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Classes</h3><ul><li><a href="Cell.html">Cell</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.2</a> on Wed Sep 10 2014 15:14:49 GMT+0200 (GMT+02:00)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
